{% extends "main/base.html" %}
{% block content %}
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ticket.title}}</h1>
  </div>
  <div>
    <a href="{% url 'ticket-update' ticket.id %}" class="btn btn-secondary btn-sm mt-1 mb-1">Update</a>
    <a href="{% url 'ticket-delete' ticket.id %}" class="btn btn-danger btn-sm mt-1 mb-1">Delete</a>
  </div>
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h3>Comments</h3>
  </div>
  <a href="{% url 'comment-create' ticket.id %}" class="btn btn-info btn-lg active mb-3" role="button" aria-pressed="true">Create A New Comment</a>
	<div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>Author</th>
          <th>Comment</th>
          <th>Date Created</th>
        </tr>
      </thead>
      <tbody>
	      {% for comment in comments %}
        <tr>
          <td>{{ comment.author }}</td>
          <td>{{ comment.message }}</td>
          <td>{{ comment.date_created }}</td>
          {% if request.user == comment.author %}
            <td>
              <a href="{% url 'comment-update' comment.id %}" class="btn btn-secondary btn-sm mt-1 mb-1">Update</a>
              <a href="{% url 'comment-delete' comment.id %}" class="btn btn-danger btn-sm mt-1 mb-1">Delete</a>
            </td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h3>Ticket History</h3>
  </div>
  <div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>User</th>
          <th>Action</th>
          <th>Old Value</th>
          <th>New Value</th>
          <th>Date Changed</th>
        </tr>
      </thead>
      <tbody>
        {% for history in history_list %}
        <tr>
          <td>{{ history.user }}</td>
          <td>{{ history.action }}</td>
          <td>{{ history.old_value }}</td>
          <td>{{ history.new_value }}</td>
          <td>{{ history.date_changed }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h3>Attachments</h3>
  </div>
	<div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>User</th>
          <th>Description</th>
          <th>File</th>
        </tr>
      </thead>
      <tbody>
        {% for attachment in attachments %}
        <tr>
          <td>{{ attachment.poster }}</td>
          <td>{{ attachment.description }}</td>
          <td><a href="{{ attachment.file.url }}">{{ attachment.title }}</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock content %}